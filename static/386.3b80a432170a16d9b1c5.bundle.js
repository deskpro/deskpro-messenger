webpackJsonp([386],{2574:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__=__webpack_require__(172),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator__=__webpack_require__(292),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of__=__webpack_require__(11),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn__=__webpack_require__(9),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn__),__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_get__=__webpack_require__(2582),__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_get___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_get__),__WEBPACK_IMPORTED_MODULE_7_babel_runtime_helpers_inherits__=__webpack_require__(10),__WEBPACK_IMPORTED_MODULE_7_babel_runtime_helpers_inherits___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_7_babel_runtime_helpers_inherits__),__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_promise__=__webpack_require__(173),__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_promise___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_promise__),__WEBPACK_IMPORTED_MODULE_9__AbstractClient__=__webpack_require__(2583),POLLING_INTERVAL=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_POLLING_INTERVAL||1e3,sleep=function sleep(time){return new __WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_promise___default.a(function(res){return setTimeout(res,time)})},PollingClient=function(_AbstractClient){function PollingClient(options,apiClient,visitorId){__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default()(this,PollingClient);var _this=__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn___default()(this,(PollingClient.__proto__||__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of___default()(PollingClient)).call(this,options,apiClient,visitorId));return _this.lastActionAlert=options.last_alert,_this}return __WEBPACK_IMPORTED_MODULE_7_babel_runtime_helpers_inherits___default()(PollingClient,_AbstractClient),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default()(PollingClient,[{key:"startListening",value:function(){var _ref=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.mark(function _callee(){return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_get___default()(PollingClient.prototype.__proto__||__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of___default()(PollingClient.prototype),"startListening",this).call(this);case 2:this.listen();case 3:case"end":return _context.stop()}},_callee,this)}));return function startListening(){return _ref.apply(this,arguments)}}()},{key:"listen",value:function(){var _ref2=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.mark(function _callee2(){var alerts,_this2=this;return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_regenerator___default.a.wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=3,this.apiClient.get("/api/messenger/user/action_alerts/"+(this.lastActionAlert||0)).then(function(_ref3){return _ref3.data});case 3:if((alerts=_context2.sent).length&&alerts.forEach(function(alert){var message=void 0;message=-200===alert.target_id?alert:_this2.transformNotification(alert),_this2.onNotificationReceived(message),_this2.lastActionAlert=alert.id}),this.isRunning){_context2.next=7;break}return _context2.abrupt("break",11);case 7:return _context2.next=9,sleep(POLLING_INTERVAL);case 9:_context2.next=0;break;case 11:case"end":return _context2.stop()}},_callee2,this)}));return function listen(){return _ref2.apply(this,arguments)}}()}]),PollingClient}(__WEBPACK_IMPORTED_MODULE_9__AbstractClient__.a);__webpack_exports__.default=PollingClient},2582:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0;var _getPrototypeOf2=_interopRequireDefault(__webpack_require__(11)),_getOwnPropertyDescriptor2=_interopRequireDefault(__webpack_require__(621));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=(0,_getOwnPropertyDescriptor2.default)(object,property);if(void 0===desc){var parent=(0,_getPrototypeOf2.default)(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0!==getter?getter.call(receiver):void 0}},2583:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__=__webpack_require__(8),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_objectWithoutProperties__=__webpack_require__(58),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_objectWithoutProperties___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_objectWithoutProperties__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator__=__webpack_require__(172),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_asyncToGenerator__=__webpack_require__(292),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_asyncToGenerator___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_asyncToGenerator__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_classCallCheck__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_classCallCheck___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_classCallCheck__),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_createClass__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_createClass___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_createClass__),AbstractClient=function(){function AbstractClient(options,apiClient,visitorId){__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_classCallCheck___default()(this,AbstractClient),this.listeners=[],this.isRunning=!1,this.apiClient=apiClient,this.options=options,this.visitorId=visitorId}return __WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_createClass___default()(AbstractClient,[{key:"startListening",value:function(){var _ref=__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.mark(function _callee(){return __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:this.isRunning=!0;case 1:case"end":return _context.stop()}},_callee,this)}));return function startListening(){return _ref.apply(this,arguments)}}()},{key:"stopListening",value:function(){var _ref2=__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.mark(function _callee2(){return __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:this.isRunning=!1;case 1:case"end":return _context2.stop()}},_callee2,this)}));return function stopListening(){return _ref2.apply(this,arguments)}}()},{key:"onNotificationReceived",value:function(){var _ref3=__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_asyncToGenerator___default()(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.mark(function _callee3(message){return __WEBPACK_IMPORTED_MODULE_2_babel_runtime_regenerator___default.a.wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:this.listeners.forEach(function(callback){return callback(message)});case 1:case"end":return _context3.stop()}},_callee3,this)}));return function onNotificationReceived(_x){return _ref3.apply(this,arguments)}}()},{key:"transformNotification",value:function transformNotification(_ref4){var data=_ref4.data,alert=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_objectWithoutProperties___default()(_ref4,["data"]);return __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_extends___default()({},data,{type:alert.type||"unknown.alert.type",chat:data.chat||data.id,uuid:data.uuid||alert.uuid,meta:data.meta||{},message:"system"===data.origin&&"string"==typeof data.message&&data.message.length?JSON.parse(data.message):data.message})}},{key:"subscribe",value:function subscribe(callback){"function"==typeof callback?this.listeners.push(callback):console.error("Subscription listener is not a function")}},{key:"unsubscribe",value:function unsubscribe(){var callback=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.listeners=callback?this.listeners.filter(function(l){return l===callback}):[],this.listeners.length||(this.isRunning=!1)}}]),AbstractClient}();__webpack_exports__.a=AbstractClient}});